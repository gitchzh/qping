# qping：一款更强大的 Windows Ping 工具

## 简介

**qping** 是一款专为 Windows 平台打造的命令行网络诊断工具，在完全兼容系统原生 `ping` 命令的基础上，扩展了网段扫描、IP 范围批量检测、多线程并发、**域名自动解析**等高级功能，是网络管理员和运维工程师的效率利器。

## 解决什么问题？

在日常网络运维中，我们经常遇到这些场景：

- 需要检测某个网段内哪些设备在线
- 批量 ping 多个不连续的 IP 地址
- 快速定位网络中的故障节点
- 统计多台设备的在线/离线状态
- **直接 ping 域名，无需手动解析 IP 地址**
- **批量检测多个网站的连通性**

使用系统自带的 `ping` 命令，只能逐个 IP 手动执行，效率低下。而 **qping** 可以一条命令完成上述所有操作。

**示例：**

```cmd
qping 192.168.1.0/24              # 扫描整个 C 段
qping 192.168.1.1-100             # 扫描 IP 范围
qping 192.168.1.1,3,5,10-20       # 扫描指定 IP
qping -t 192.168.1.1              # 持续 ping
qping google.com                  # 域名 ping（自动 DNS 解析）
qping google.com,baidu.com,localhost  # 同时 ping 多个域名
qping -4 google.com               # 强制使用 IPv4 解析域名
qping -6 localhost                # 强制使用 IPv6 解析域名
```

## 功能对比

| 功能特性 | Windows Ping | Linux fping | qping |
|---------|:------------:|:-----------:|:-----:|
| 单目标 Ping | ✅ | ✅ | ✅ |
| **域名解析** | ✅（仅单域名） | ✅ | ✅（支持多域名） |
| CIDR 网段扫描 | ❌ | ✅ | ✅ |
| IP 范围扫描 | ❌ | ✅ | ✅ |
| 逗号分隔多目标 | ❌ | ❌ | ✅ |
| 混合格式 (如 1,3-5,10) | ❌ | ❌ | ✅ |
| 多线程并发 | ❌ | ✅ | ✅ (可配置) |
| 自动统计在线/离线 | ❌ | ✅ | ✅ |
| IP 范围压缩显示 | ❌ | ❌ | ✅ |
| IPv6 支持 | ✅ | ✅ | ✅ |
| 记录路由/时间戳 | ✅ | ❌ | ✅ |
| 需要管理员权限 | ❌ | ✅ | ❌ |
| Windows 原生支持 | ✅ | ❌ | ✅ |

## 输出示例

```
总目标数: 10

来自 192.168.1.1 的回复: 字节=32 时间=1ms TTL=64
来自 192.168.1.2 的回复: 字节=32 时间=2ms TTL=64
请求超时 192.168.1.3
...

--- 统计信息 ---
数据包统计: 发送=10, 接收=8, 丢失=2 (20.0%)

在线设备 (8): 192.168.1.1-2, 192.168.1.4-5, 192.168.1.10-12
失败设备 (2): 192.168.1.3, 192.168.1.6
```

**域名 ping 示例：**

```
总目标数: 3
来自 142.251.43.238 的回复: 字节=32 时间=25ms TTL=114
来自 110.242.68.3 的回复: 字节=32 时间=38ms TTL=49
来自 127.0.0.1 的回复: 字节=32 时间=0ms TTL=128

--- 统计信息 ---
110.242.68.3 : 已发送=1, 已接收=1, 丢失=0 (0.0%)
127.0.0.1 : 已发送=1, 已接收=1, 丢失=0 (0.0%)
142.251.43.238 : 已发送=1, 已接收=1, 丢失=0 (0.0%)

数据包统计: 发送=3, 接收=3, 丢失=0 (0.0%)

在线设备 (3): 110.242.68.3, 127.0.0.1, 142.251.43.238
失败设备 (0): (无)
```

## 安装与使用

qping 支持**自动安装**，只需双击运行即可完成环境变量配置！

### 自动安装（推荐）

**最简单的使用方式：**

1. 将 `qping.exe` 复制到任意目录（如 `D:\Tools\qping`）
2. **右键点击 `qping.exe`，选择"以管理员身份运行"**
3. 程序会自动检测并添加到系统 PATH 环境变量
4. 关闭并重新打开命令行窗口即可使用

**工作原理：**
- 程序启动时自动检测当前目录是否已在系统 PATH 中
- 如果不在且具有管理员权限，则自动添加
- 如果已在 PATH 中或没有管理员权限，则静默跳过

**注意：**
- 需要管理员权限才能自动添加到系统 PATH
- 安装后需要关闭并重新打开命令行窗口才能生效
- 如果没有管理员权限，可以手动安装

### 手动安装

**方式一：添加到系统环境变量（推荐）**

1. 将 `qping.exe` 放置到任意目录（如 `C:\Tools`）
2. 将该目录添加到系统环境变量 `PATH` 中
3. 打开新的命令行窗口即可使用

**方式二：复制到系统目录**

将 `qping.exe` 直接复制到 `C:\Windows\System32` 目录下，即可在任意位置直接使用。

### 常用命令

```cmd
qping --help                      # 查看帮助
qping --version                   # 查看版本
qping -n 5 192.168.1.1            # 发送 5 次
qping -t 192.168.1.1              # 持续 ping (Ctrl+C 停止)
qping --concurrency 200 10.0.0.0/24   # 高并发扫描
qping google.com                  # ping 域名
qping -a google.com               # 显示域名对应的主机名
qping -4 baidu.com                # 强制使用 IPv4 解析
qping -6 localhost                # 强制使用 IPv6 解析
qping google.com,baidu.com,192.168.1.1  # 混合域名和 IP
```

**域名解析特性：**

1. **自动 DNS 解析**：输入域名自动解析为 IP 地址
2. **多地址支持**：一个域名可能解析为多个 IP 地址（如 localhost 解析为 127.0.0.1 和 ::1）
3. **协议控制**：使用 `-4` 强制 IPv4 解析，`-6` 强制 IPv6 解析
4. **超时处理**：DNS 查询 2 秒超时，避免无网络环境长时间等待
5. **智能识别**：自动区分 IP 地址和域名，不会误判

## 技术特点

### 跨版本兼容性
- **完全静态链接**：无需任何额外 DLL，仅依赖 Windows 系统文件
- **支持 Windows 7/8/10/11**：目标版本设置为 Windows Vista，确保向下兼容
- **无运行时依赖**：不依赖 MinGW 运行时库（如 libgcc_s_*.dll、libstdc++-6.dll）

### 高性能设计
- **多线程并发**：默认 100 线程，可自定义调整
- **智能超时**：DNS 解析和 ping 操作均有超时机制
- **内存安全**：使用 RAII 管理资源，防止内存泄漏

### 用户友好
- **中文支持**：完美支持中文系统，无乱码问题
- **详细统计**：自动统计在线/离线设备，压缩显示 IP 范围
- **快捷键支持**：Ctrl+C 停止，Ctrl+Break 显示中间统计

## 安全声明

**qping 是完全安全、开源的软件：**

- ✅ 开源协议：MIT License
- ✅ 使用 Windows 原生 ICMP API，无需安装驱动
- ✅ 无需管理员权限运行
- ✅ 不收集任何用户数据
- ✅ 代码完全公开，可自行审查和编译
- ✅ **DNS 解析使用 Windows 系统 API**，不实现自定义 DNS 解析

## 版本历史

### v1.2.0 (最新)
- 新增域名支持，可直接 ping 网址（如 `google.com`）
- 支持一次 ping 多个网址（如 `google.com,localhost,yahoo.com`）
- 支持 `-4` 和 `-6` 选项强制使用 IPv4/IPv6 解析域名
- 改进逗号分隔目标处理逻辑，支持混合域名和 IP

### v1.1.0
- 重构为多文件结构，便于维护
- 新增逗号分隔目标格式（如 `192.168.2.1,3,5` 或 `192.168.2.1,3-5,10`）
- 优化统计输出，自动压缩连续 IP 为范围格式

### v1.0.1
- 修复在无环境变量的计算机中运行缺少 DLL 的问题
- 修复中文系统中文显示乱码问题
- 优化首次运行速度

## 获取 qping

**GitHub 仓库：** https://github.com/gitchzh/qping

您可以从 GitHub Release 页面下载编译好的可执行文件，或自行克隆源码编译。

**编译要求：**
- Windows 操作系统
- C++14 编译器（MSVC、MinGW 或 Clang）
- Windows SDK

**快速编译（MinGW）：**
```bash
g++ -std=c++14 -O2 -I src -finput-charset=utf-8 -fexec-charset=gbk -static -static-libgcc -static-libstdc++ src/main.cpp src/ping.cpp src/target.cpp -o qping.exe -lIphlpapi -lWs2_32
```

如有问题或建议，欢迎在 GitHub 提交 Issue。

---

*作者：mrchzh | 邮箱：gmrchzh@gmail.com | 版本：v1.2.0*